# 19.卷积层

## 19.1.从全连接到卷积

$$
h_{i,j}=\sum_{k,l}W_{i,j,k,l}x_{k,l}=\sum_{a,b}v_{i,j,a,b}x_{i+a,j+b}
$$

实际上这个公式描述的就是二维图片和二维卷积核的卷积操作（[什么是卷积](https://www.bilibili.com/video/BV1VV411478E/?spm_id_from=333.788.top_right_bar_window_custom_collection.content.click&vd_source=8924ad59b4f62224f165e16aa3d04f00)）  

其中`v`是卷积核矩阵，`x`是图片矩阵  

**原则1 平移不变性**

+ x的平移会导致h的平移 


$$
h_{i,j}=\sum_{a,b}^{}v_{i,j,a,b}x_{i+a,j+b}
$$


+ v不应该依赖于(i,j) （也就是无论i,j如何变化，v都是那个v）
+ 解决方案: $v_{i,j,a,b}=v_{a,b}$


$$
h_{i,j}=\sum_{a,b}^{}v_{a,b}x_{i+a,j+b}
$$

​	

这就是2维~~卷积~~交叉相关

**原则2 局部性**

换了一种形式，当 $|a|,|b|>\Delta$ 时，使得 $v_{a,b=0}$


$$
h_{i,j}=\sum_{a=-\Delta}^{\Delta}\sum_{b=-\Delta}^{\Delta}v_{a,b}x_{i+a,j+b}
$$

## 19.2.卷积层

**交叉相关VS卷积**

区别就是在索引卷积核时，两者索引顺序是对称的，为了计算方便使用前者  

它们在实际使用中没有区别

**一维和三维交叉计算**

这里主要关注的是二维计算，一维和三维的计算也是有的  

一维：文本、语言、时序序列


$$
y_i=\sum_{a=1}^{h}w_ax_{i+a}
$$


三维：视频、医学图像、气象地图


$$
y_{i,j,k}=\sum_{a=1}^{h}\sum_{b=1}^{w}\sum_{c=1}^{d}w_{a,b,c}x_{i+a,j+b,k+c}
$$


**总结**

+ 卷积层将输入和核矩阵进行交叉相关，加上偏移后得到输出
+ 核矩阵和偏移是可学习的参数
+ 核矩阵的大小是超参数

## 19.3.代码

手写了梯度下降  

`19.3.卷积层代码`

# 20.卷积层里的填充和步幅

